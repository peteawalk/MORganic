<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>testing.html</title>
</head>

<body>
    <h1>Open console</h1>
    <button id="submit">submit</button>

    <div id="marketDetails"></div>



    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script>
        //Vars
        farmersMarketIdArray = [];
        var marketURL = "https://search.ams.usda.gov/farmersmarkets/v1/data.svc/zipSearch?zip=64063";

        $(document).ready(function () {

            $("#submit").on("click", function () {

                $.ajax({
                    url: marketURL,
                    type: "GET" //or POST to send data 
                    //data: data, // if the type is POST
                }).then(function (response) {
                    var queryResults = response.results;
                    console.table(queryResults);
                    for (j = 0; j < 5; j++) { // Get top 5 closest farmer's markets.
                        farmersMarketIdArray.push((queryResults[j].id));
                    }
                    console.log(`farmersMarketIdArray is: ${farmersMarketIdArray}`);
                    getDetails();
                });
            });


            function getDetails(id) {
                for (n = 0; n < farmersMarketIdArray.length; n++) {
                    var id = farmersMarketIdArray[n];
                    $.ajax({
                        type: "GET",
                        contentType: "application/json; charset=utf-8",
                        // submit a get request to the restful service mktDetail.
                        url: "http://search.ams.usda.gov/farmersmarkets/v1/data.svc/mktDetail?id=" + id,
                        dataType: 'jsonp'
                    }).then(function (secondResponse) {
                        var marketDetails = secondResponse.marketdetails
                        var marketAddress = marketDetails.Address
                        var marketProducts = marketDetails.Products
                        var marketSchedule = marketDetails.Schedule
                        console.log(`Address is: ${marketDetails.Address}`);
                        console.log(`Products available: ${marketDetails.Products}`);
                        console.log(`Hours: ${marketDetails.Schedule}`);
                        $("#marketDetails").append(`Address: ${marketAddress} <br>`);
                        $("#marketDetails").append(`Products: ${marketProducts} <br>`);
                        $("#marketDetails").append(`Schedule: ${marketSchedule} <br>`);

                    })
                }
            }
        });
    </script>
</body>

</html>